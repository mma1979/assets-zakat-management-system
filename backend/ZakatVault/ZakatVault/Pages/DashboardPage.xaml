<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:strings="clr-namespace:ZakatVault.Resources.Strings"
             x:Class="ZakatVault.Pages.DashboardPage"
             Title="Dashboard"
             BackgroundColor="#F5F7FA">
    
   

    <ScrollView>
        <VerticalStackLayout Spacing="20" Padding="20">

            <!-- Header Section -->
            <Grid Padding="0" Margin="0,10,0,10">
                <VerticalStackLayout>
                    <Label Text="{x:Static strings:AppResources.Dashboard}" FontSize="26" FontAttributes="Bold" TextColor="{DynamicResource MidnightBlue}" />
                    <Label Text="{x:Static strings:AppResources.DashboardDesc}" FontSize="14" TextColor="{DynamicResource Gray500}" />
                </VerticalStackLayout>
                <!-- Action Buttons (Placeholders) -->
                <HorizontalStackLayout HorizontalOptions="End" VerticalOptions="Start" Spacing="10">
                    <Button Text="⬇" BackgroundColor="White" TextColor="{DynamicResource Gray600}" HeightRequest="40" WidthRequest="40" CornerRadius="8" Padding="0" BorderColor="{DynamicResource Gray200}" BorderWidth="1" />
                    <Button Text="✎" BackgroundColor="White" TextColor="{DynamicResource Gray600}" HeightRequest="40" WidthRequest="40" CornerRadius="8" Padding="0" BorderColor="{DynamicResource Gray200}" BorderWidth="1" />
                    <Button Text="🔄" BackgroundColor="White" TextColor="{DynamicResource Gray600}" HeightRequest="40" WidthRequest="40" CornerRadius="8" Padding="0" BorderColor="{DynamicResource Gray200}" BorderWidth="1" />
                </HorizontalStackLayout>
            </Grid>

            <!-- AI Advisor Card -->
            <Border BackgroundColor="{DynamicResource AdvisorPurple}" StrokeThickness="0" StrokeShape="RoundRectangle 15" Padding="20">
                <VerticalStackLayout Spacing="15">
                    <HorizontalStackLayout Spacing="10">
                        <!-- Icon Placeholder -->
                        <Border BackgroundColor="{DynamicResource BrandGreenLight}" Padding="10"  StrokeShape="RoundRectangle 30"  HeightRequest="40" WidthRequest="40">
                            <Label Text="✨" TextColor="{DynamicResource BrandGreen}" HorizontalOptions="Center" VerticalOptions="Center" />
                        </Border>
                        <VerticalStackLayout>
                            <Label Text="{x:Static strings:AppResources.AIAdvisor}" FontAttributes="Bold" FontSize="16" TextColor="{DynamicResource MidnightBlue}" />
                            <Label Text="{x:Static strings:AppResources.AIAdvisorDesc}" FontSize="12" TextColor="{DynamicResource Gray600}" LineBreakMode="WordWrap" />
                        </VerticalStackLayout>
                    </HorizontalStackLayout>

                    <Button Text="{x:Static strings:AppResources.AnalyzePortfolio}" 
                            BackgroundColor="{DynamicResource AdvisorPurpleDark}" 
                            TextColor="White" 
                            FontAttributes="Bold"
                            CornerRadius="8"
                            HorizontalOptions="Center"
                            Padding="20,10" />
                </VerticalStackLayout>
            </Border>

            <!-- Stats Cards -->
            <VerticalStackLayout Spacing="15">
                <!-- Net Worth -->
                <Border BackgroundColor="White" StrokeThickness="0" StrokeShape="RoundRectangle 15" Padding="20">
                    <HorizontalStackLayout Spacing="15" VerticalOptions="Center">
                        <Border BackgroundColor="#E3F2FD" Padding="15" StrokeShape="RoundRectangle 15" HeightRequest="50" WidthRequest="50">
                            <Label Text="📈" TextColor="#1565C0" HorizontalOptions="Center" VerticalOptions="Center" FontSize="18"/>
                        </Border>
                        <VerticalStackLayout VerticalOptions="Center">
                            <Label Text="{x:Static strings:AppResources.NetWorth}" TextColor="{DynamicResource Gray500}" FontSize="12" />
                            <Label Text="{Binding Summary.NetWorth, StringFormat='{0:N2}'}" TextColor="{DynamicResource MidnightBlue}" FontAttributes="Bold" FontSize="20" />
                        </VerticalStackLayout>
                    </HorizontalStackLayout>
                </Border>

                <!-- Total Assets -->
                <Border BackgroundColor="White" StrokeThickness="0" StrokeShape="RoundRectangle 15" Padding="20">
                    <HorizontalStackLayout Spacing="15" VerticalOptions="Center">
                        <Border BackgroundColor="#FFF8E1" Padding="15" StrokeShape="RoundRectangle 15" HeightRequest="50" WidthRequest="50">
                            <Label Text="⚖" TextColor="#F9A825" HorizontalOptions="Center" VerticalOptions="Center" FontSize="18"/>
                        </Border>
                        <VerticalStackLayout VerticalOptions="Center">
                            <Label Text="{x:Static strings:AppResources.TotalAssets}" TextColor="{DynamicResource Gray500}" FontSize="12" />
                            <Label Text="{Binding Summary.TotalAssets, StringFormat='{0:N2}'}" TextColor="{DynamicResource MidnightBlue}" FontAttributes="Bold" FontSize="20" />
                        </VerticalStackLayout>
                    </HorizontalStackLayout>
                </Border>

                <!-- Total Liabilities -->
                <Border BackgroundColor="White" StrokeThickness="0" StrokeShape="RoundRectangle 15" Padding="20">
                    <HorizontalStackLayout Spacing="15" VerticalOptions="Center">
                        <Border BackgroundColor="#FFEBEE" Padding="15" StrokeShape="RoundRectangle 15" HeightRequest="50" WidthRequest="50">
                            <Label Text="💲" TextColor="#C62828" HorizontalOptions="Center" VerticalOptions="Center" FontSize="18"/>
                        </Border>
                        <VerticalStackLayout VerticalOptions="Center">
                            <Label Text="{x:Static strings:AppResources.TotalLiabilities}" TextColor="{DynamicResource Gray500}" FontSize="12" />
                            <Label Text="{Binding Summary.TotalLiabilities, StringFormat='{0:N2}'}" TextColor="{DynamicResource MidnightBlue}" FontAttributes="Bold" FontSize="20" />
                        </VerticalStackLayout>
                    </HorizontalStackLayout>
                </Border>
            </VerticalStackLayout>

            <!-- Chart Section 1: Portfolio Composition -->
            <Border BackgroundColor="White" StrokeThickness="0" StrokeShape="RoundRectangle 15" Padding="20">
                <VerticalStackLayout Spacing="15">
                    <Label Text="{x:Static strings:AppResources.PortfolioComposition}" FontAttributes="Bold" FontSize="16" TextColor="{DynamicResource MidnightBlue}" />

                    <!-- Donut Chart -->
                    <GraphicsView x:Name="PortfolioChart" HeightRequest="250" WidthRequest="250" HorizontalOptions="Center" />
                    
                    <!-- Legend -->
                    <FlexLayout BindableLayout.ItemsSource="{Binding PortfolioComposition}" 
                                Wrap="Wrap" 
                                JustifyContent="Center" 
                                AlignItems="Center" 
                                Direction="Row">
                        <BindableLayout.ItemTemplate>
                            <DataTemplate>
                                <HorizontalStackLayout Spacing="5" Margin="5">
                                    <BoxView Color="{Binding Color}" HeightRequest="12" WidthRequest="12" CornerRadius="3" VerticalOptions="Center" />
                                    <Label Text="{Binding Name}" TextColor="{DynamicResource MidnightBlue}" FontSize="12" VerticalOptions="Center" />
                                    <Label Text="{Binding Percentage, StringFormat='({0:P1})'}" TextColor="{DynamicResource Gray500}" FontSize="12" VerticalOptions="Center" />
                                </HorizontalStackLayout>
                            </DataTemplate>
                        </BindableLayout.ItemTemplate>
                    </FlexLayout>
                </VerticalStackLayout>
            </Border>

            <!-- Current Market Rates -->
            <Border BackgroundColor="White" StrokeThickness="0" StrokeShape="RoundRectangle 15" Padding="20">
                <VerticalStackLayout Spacing="15">
                    <Grid>
                        <Label Text="{x:Static strings:AppResources.MarketRates}" FontAttributes="Bold" FontSize="16" TextColor="{DynamicResource MidnightBlue}" VerticalOptions="Center" />
                        <Label Text="{x:Static strings:AppResources.Edit}" TextColor="{DynamicResource BrandGreen}" FontSize="12" HorizontalOptions="End" VerticalOptions="Center" />
                    </Grid>

                    <VerticalStackLayout BindableLayout.ItemsSource="{Binding Rates}" Spacing="5">
                        <BindableLayout.ItemTemplate>
                            <DataTemplate>
                                <Border BackgroundColor="{DynamicResource Gray100}" StrokeThickness="0" StrokeShape="RoundRectangle 8" Padding="15,10">
                                    <Grid>
                                        <Label Text="{Binding Name, StringFormat='● {0}'}" TextColor="{DynamicResource MidnightBlue}" VerticalOptions="Center" />
                                        <Label HorizontalOptions="End" VerticalOptions="Center" TextColor="{DynamicResource MidnightBlue}" FontAttributes="Bold">
                                            <Label.FormattedText>
                                                <FormattedString>
                                                    <Span Text="{Binding Price, StringFormat='{0:N2}'}" />
                                                    <Span Text=" " />
                                                    <Span Text="{Binding Unit}" />
                                                </FormattedString>
                                            </Label.FormattedText>
                                        </Label>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </BindableLayout.ItemTemplate>
                    </VerticalStackLayout>

                    <Label Text="{x:Static strings:AppResources.MarketDisclaimer}" FontSize="10" TextColor="{DynamicResource Gray500}" BackgroundColor="{DynamicResource AdvisorPurple}" Padding="10" />
                </VerticalStackLayout>
            </Border>

            <!-- Chart Section 2: Portfolio Value History -->
            <Border BackgroundColor="White" StrokeThickness="0" StrokeShape="RoundRectangle 15" Padding="20">
                <VerticalStackLayout Spacing="15">
                    <Label Text="{x:Static strings:AppResources.PortfolioHistory}" FontAttributes="Bold" FontSize="16" TextColor="{DynamicResource MidnightBlue}" />
                    <Label Text="{x:Static strings:AppResources.HistoryDesc}" FontSize="12" TextColor="{DynamicResource Gray500}" />

                    <!-- Placeholder for Line Chart -->
                    <BoxView HeightRequest="200" Color="#FAFAFA" />
                    <Label Text="(Line Chart Placeholder)" HorizontalOptions="Center" TextColor="{DynamicResource Gray400}" Margin="0,-110,0,0" />
                    <BoxView HeightRequest="1" Color="Transparent" Margin="0,100,0,0"/>

                </VerticalStackLayout>
            </Border>

            <!-- Final Spacing -->
            <BoxView HeightRequest="50" />

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
